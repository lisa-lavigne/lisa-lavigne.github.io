---
import Chips from './Chips.astro';

interface Props {
	imageSrc: string;
	category: string;
	title: string;
	description: string;
	tags: string[];
	slug: string;
}

const { imageSrc, category, title, description, tags, slug } = Astro.props;

// Dividir tags en dos grupos: pocos en la primera línea, el resto en la segunda
// Tomamos los primeros 2-3 tags para la primera línea, el resto para la segunda
const firstLineTags = tags.slice(0, Math.min(4, Math.floor(tags.length / 2)));
const secondLineTags = tags.slice(firstLineTags.length);

// Función para parsear texto con negrita usando formato **texto**
function parseBoldText(text: string) {
	if (!text) return [];
	
	const parts: Array<{text: string, bold: boolean}> = [];
	const regex = /\*\*(.*?)\*\*/g;
	let lastIndex = 0;
	let match;
	
	while ((match = regex.exec(text)) !== null) {
		// Agregar texto antes del match
		if (match.index > lastIndex) {
			parts.push({ text: text.substring(lastIndex, match.index), bold: false });
		}
		// Agregar texto en negrita
		parts.push({ text: match[1], bold: true });
		lastIndex = regex.lastIndex;
	}
	
	// Agregar texto restante
	if (lastIndex < text.length) {
		parts.push({ text: text.substring(lastIndex), bold: false });
	}
	
	// Si no hay matches, devolver el texto completo
	if (parts.length === 0) {
		parts.push({ text, bold: false });
	}
	
	return parts;
}
---

<a href={`/works/${slug}`} class="flex gap-6 h-[445px] items-center w-full hover:opacity-90 transition-opacity py-10">
	<!-- Imagen a la izquierda -->
	<div class="h-full relative rounded-2xl shrink-0 w-full md:w-[700px] overflow-hidden">
		<div aria-hidden="true" class="absolute inset-0 pointer-events-none rounded-2xl">
			<div class="absolute bg-black/20 inset-0 rounded-2xl"></div>
			<div class="absolute inset-0 overflow-hidden rounded-2xl">
				<img 
					src={imageSrc} 
					alt={title} 
					class="absolute h-full w-full object-cover min-w-[512px] min-h-[445px]"
				/>
			</div>
		</div>
	</div>
	
	<!-- Contenido de texto a la derecha -->
	<div class="flex-1 flex flex-col h-[445px] items-center justify-between pl-6 pr-10 py-10">
		<div class="flex-1 flex flex-col items-start justify-between w-full">
			<!-- Sección superior: Título y descripción -->
			<div class="flex flex-col gap-6 items-start w-full">
				<!-- Título con categoría y flecha -->
				<div class="flex items-start justify-between gap-[10px] w-full">
					<div class="flex flex-col gap-2 flex-1">
						<h3 class="text-sb1 font-subheading font-semibold text-secondary-200 leading-normal">{category}</h3>
						<div class=" font-heading font-bold text-secondary-400 leading-normal">
							{title.split('\n').map((line) => (
								<h3 class="block mb-0">{line}</h3>
							))}
						</div>
					</div>
					<!-- Ícono de flecha en esquina superior derecha (arrow-up-right) -->
					<div class="w-12 h-12 flex-shrink-0">
						<svg class="w-full h-full text-secondary-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
							<path stroke-linecap="round" stroke-linejoin="round" d="M4.5 19.5L19.5 4.5M19.5 4.5H9M19.5 4.5V15" />
						</svg>
					</div>
				</div>
				
				<!-- Descripción -->
				<p class="text-body-md font-body text-secondary-300 leading-normal w-full">
					{parseBoldText(description).map((part, idx) => (
						part.bold ? (
							<span class="font-bold">{part.text}</span>
						) : (
							<span>{part.text}</span>
						)
					))}
				</p>
			</div>
			
			<!-- Sección inferior: Tags/Chips -->
			<div class="flex flex-col gap-3 w-full">
				<!-- Primera línea: pocos tags -->
				{firstLineTags.length > 0 && (
					<div class="flex gap-3  w-full">
						{firstLineTags.map((tag) => (
							<Chips variant="outline" text={tag} />
						))}
					</div>
				)}
				<!-- Segunda línea: el resto de tags -->
				{secondLineTags.length > 0 && (
					<div class="flex flex-wrap gap-3 w-full">
						{secondLineTags.map((tag) => (
							<Chips variant="outline" text={tag} />
						))}
					</div>
				)}
			</div>
		</div>
	</div>
</a>

